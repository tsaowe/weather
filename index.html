<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>气象观测数据展示平台</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/dashboard.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>


    <![endif]-->

    <!--总体研究思路为：-->
    <!--硬件端：将采集大量的气象数据，如气压、气温、温度、湿度、风力、风向、降雨量、降雪量、能见度、辐射、日照等因素的数据。（硬件数据采用数据模拟的方式实现）-->
    <!--服务器端：将所有硬件端传来的数据进行整合、存储，然后分析，在网站上给出监控和预测的曲线图以及数据显示，并且将根据分析出来的数据将预测出的现象给出报警装置，提供实时报警。-->
    <!--工作重点：难度主要是在于如何将所有接收的大量的数据进行分析，给出展示，并监控，给出完善的预测趋势等信息，提供准确的实时报警等功能。-->


    <!--最近几十年来，因全球气温变暖，导致气象灾害频发，而且愈发厉害。这些多为突发性、局地性的气象灾害呈现多发、频发、重发态势，发生的时间短、危害度大，如何对实时接收的气象信息进行快速分析及监测成为当务之急。-->
    <!--到目前为止，全国各气象部门均对雷雨冰雹、大风暴雨、大雾沙尘暴、降雪、高温热浪等突发性灾害天气通过多种手段进行灾害性天气的分析与监测。但如今，如何建立完善的气象分析和气象监测系统仍然面临着严峻挑战。由于目前气象信息的收集、发布、接收还不够规范，同时没有一个完善而且快速的气象信息分析和监测系统，无法快速地在各网络进行监测预警。传统、单一、低效率的气象分析监测系统已经无法满足如今愈发疯狂的气象灾害的预测，如何构建智能、功能完善、有效的气象分析与监测系统，是预防气象灾害亟待解决的重点。-->
    <!--本系统的设计实现可在对实时接收的气象信息的基础上，真正意义上实现集存储、分析、监控和预警为一体的智能气象系统展示与监控，将有效保证对所接收的气象信息分析和监测的针对性、时效性、准确性和智能性。-->


    <!--1、2015年12月15日至2016年2月29日：指导教师指导学生对所选择的课题进行调研、资料的收集、向学生下达毕业论文(设计)任务书、并指导学生完成开题报告；-->
    <!--2、2016年2月29日至2016年3月7日：查阅相关资料，编写系统的开发设计文档，对系统进行详细系统的功能定义并确定下一步开发；-->
    <!--3、2016年3月7日至4月1日：系统功能的编码实现；准备中期检查。-->
    <!--4、2016年4月1日至5月15日：系统全面测试，归并相关系统开发文档，完成毕业论文的撰写及定稿；-->
    <!--5、2016年5月16至6月5日：系统演示检查、答辩资格审查；-->
    <!--6、2016年6月6日至6月20日：论文上传、答辩等。-->

</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">成都市气数据</a>
        </div>
    </div>
</nav>
<!--
当地时间
T（温度）
Po（气压）
P（海平面气压）
Pa
U（湿度）
DD（风向）
Ff（平均风速）	N	WW	W1	W2	Tn（最低气温）	Tx（最高气温）	H(天空可见度)	RRR（降水量）	E-->

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li class=""><a class="data" href="#">实时数据展示[示例]</a></li>

                <li><a href="#" class="t-y">年度气温走势</a></li>
                <li><a href="#" class="t-m">月度气温走势</a></li>

                <li><a href="#" class="f-y">年度风向统计</a></li>
                <li><a href="#" class="f-m">月度风向统计</a></li>

                <li><a href="#" class="v-y">年度风力统计</a></li>
                <li><a href="#" class="v-m">月度风力统计</a></li>
            </ul>

        </div>
        <div class="container-wrapper col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">


        </div>
    </div>
</div>

<div class="hide table-wrapper">
    <table class="table table-striped">

    </table>
</div>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="js/jquery.min.js"></script>
<script src="bootstrap/dist/js/bootstrap.min.js"></script>
<script src="js/index.js"></script>


<script type="text/javascript" src="FCF/FusionCharts.js"></script>
<script type="text/javascript" src="FCF/prettify.js"></script>
<script type="text/javascript" src="FCF/json2.js"></script>


<div class="modal fade" id="myModal" tabindex="-1" role="dialog" data-keyboard="false" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">气象预警</h4>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>-->
                <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>




</body>

<script>

    var wrapper = $('.container-wrapper');
    var table = $('.table');
    var tableWrapper = $('.table-wrapper');
    var tr = $('<tr></tr>');
    var td = $('<td></td>');


    var arr;


    setTimeout(function () {
        arr = $(window).data('data');
        var brand = $('.navbar-brand');
        brand.html(brand.html() + '[ok]');

        var counter = 0;
        var appendItems = $.grep(arr.reverse(), function (item, index) {
            if(item[0].indexOf('.2014') > 0){
                counter ++;
            }
            return counter >0 && counter <21;
        });

        appendItems.unshift(arr.reverse()[arr.length - 1]);
        $.each(appendItems,function(i,t){
            var innerTr = tr.clone();
            $.each(t,function(){
                innerTr.append(td.clone().html(this+''));
            });
            table.append(innerTr);
        });


        var pushItems = $.grep(arr, function (item, index) {
            return item[0].indexOf('.2015') > 0
        });

        $('.data').click();

        setInterval(function(){
            var innerTr = tr.clone();
            $.each(pushItems.shift(),function(){
                innerTr.append(td.clone().html(this+''));
            });
            table.find('tr:first').after(innerTr);
        },2000);

    }, 3000);


    var years = [2010,2011,2012,2013,2014,2015];
    var months = [1,2,3,4,5,6,7,8,9,10,11,12];

    $('ul.nav-sidebar a').click(function () {
        if ($(this).is('[class="t-y"]')) {
            var select = $('<select/>');
            var option = $('<option></option>');

            $.each(years,function(idx,y){
                select.append(option.clone().html(y).val(y));
            });
            wrapper.html(select);
            wrapper.append('<div id="container"/>');
            select.change(function(){
                var year = $(this).val();
                var yearArray = $.grep(arr, function (item, index) {
                    return item[0].indexOf(year) > 0;
                });
                var sets = yearArray.map(function (array) {
                    return '<set label="' + array[0] + '" value="' + array[1] + '"/>';
                });
                var chartData = '<chart caption="'+year+'气温变化曲线" palette="2" animation="1" showValues="0" formatNumberScale="1" numberSuffix=" 度" labelDisplay="ROTATE" numDivLines="5" slantLabels="1">';
                chartData += sets.join('');
                chartData += '</chart>';
                var chart = new FusionCharts("FCF/Column3D.swf", "ChartId", $('.container-wrapper').width() * 2, $(window).height()/2, "0", "0");
                chart.setXMLData(chartData);
                chart.render("container");
            }).trigger('change')

        }else if ($(this).is('[class="t-m"]')) {
            select = $('<select/>');
            option = $('<option></option>');

            $.each(years, function (idx, y) {
                $.each(months, function (idxm, m) {
                    select.append(option.clone().html(m + '.' + y).val(m + '.' + y));
                })
            });
            wrapper.html(select);
            wrapper.append('<div id="container"/>');
            select.change(function(){
                var yearAndMont = $(this).val();
                var yearArray = $.grep(arr, function (item, index) {
                    return item[0].indexOf(yearAndMont) > 0;
                });
                var sets = yearArray.map(function (array) {
                    return '<set label="' + array[0] + '" value="' + array[1] + '"/>';
                });
                var chartData = '<chart caption="'+yearAndMont+'气温变化曲线" palette="2" animation="1" showValues="0" formatNumberScale="1" numberSuffix=" 度" labelDisplay="ROTATE" numDivLines="5" slantLabels="1">';
                chartData += sets.join('');
                chartData += '</chart>';
                var chart = new FusionCharts("FCF/Column3D.swf", "ChartId", $('.container-wrapper').width(), $(window).height()/2, "0", "0");
                chart.setXMLData(chartData);
                chart.render("container");
            }).trigger('change')

        }else if($(this).is('[class^="f"]')){

            select = $('<select/>');
            option = $('<option></option>');

            var className = $(this).attr('class');


            if(className == 'f-m') {
                $.each(years, function (idx, y) {
                    $.each(months, function (idxm, m) {
                        select.append(option.clone().html(m + '.' + y).val(m + '.' + y));
                    })
                });
            }else {
                $.each(years,function(idx,y){
                    select.append(option.clone().html(y).val(y));
                });
            }

            wrapper.html(select);
            wrapper.append('<div id="container"/>');



            select.change(function(){
                var yearAndMont = $(this).val();
                var yearArray = $.grep(arr, function (item, index) {
                    return item[0].indexOf(yearAndMont) > 0;
                });
                var type = {};
                $.each(yearArray,function(index,array){
                    var f = $.trim(array[6]||'无记录风向');
                    if(!!type[f]){
                        type[f] = type[f] + 1;
                    }else {
                        type[f] = 1;
                    }
                });

                var sets = [];
                $.each(type,function(key,value){
                    sets.push("<set value='"+value+"' label='"+key+"'/>");
                });

                var chartData = "<chart caption='"+yearAndMont+"风向统计' showPercentageInLabel='1' showValues='0' showLabels='0' showLegend='1'>";
                chartData += sets.join('');
                chartData += '</chart>';
                var chart = new FusionCharts("FCF/Pie2D.swf", "ChartId", $('.container-wrapper').width(), $(window).height() /2, "0", "0");
                chart.setXMLData(chartData);
                chart.render("container");
            }).trigger('change')

        } else if ($(this).is('[class^="v"]')) {

            select = $('<select/>');
            option = $('<option></option>');

            className = $(this).attr('class');


            if(className == 'v-m') {
                $.each(years, function (idx, y) {
                    $.each(months, function (idxm, m) {
                        select.append(option.clone().html(m + '.' + y).val(m + '.' + y));
                    })
                });
            }else {
                $.each(years,function(idx,y){
                    select.append(option.clone().html(y).val(y));
                });
            }

            wrapper.html(select);
            wrapper.append('<div id="container"/>');



            select.change(function(){
                var yearAndMont = $(this).val();
                var yearArray = $.grep(arr, function (item, index) {
                    return item[0].indexOf(yearAndMont) > 0;
                });

                var sets = yearArray.map(function (array) {
                    return '<set label="' + array[0] + '" value="' + array[7] + '"/>';
                });

                var chartData = "<chart caption='"+yearAndMont+"风力统计' showPercentageInLabel='1' showValues='0' showLabels='0' showLegend='1'>";
                chartData += sets.join('');
                chartData += '</chart>';
                var chart = new FusionCharts("FCF/Column3D.swf", "ChartId", $('.container-wrapper').width(), $(window).height()/2, "0", "0");
                chart.setXMLData(chartData);
                chart.render("container");
            }).trigger('change')

        }else if($(this).is('.data')){
            wrapper.html(table);
        }
    });


    setInterval(function(){
        if($('#myModal').is(':hidden')) {

            // 最高温度为后面的乘数
            var randomTemp = Math.random() * 40;
            if(randomTemp > 100){
                $('#myModal').modal().find('.modal-body').html('当前温度超出预警温度:'+randomTemp.toFixed(2));
            }
        }

        if(table.text().replace(/ /g,'').length > 0){

        }
    },1000);






</script>


</html>
